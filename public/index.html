<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
        rel="stylesheet"
        href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
        integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk"
        crossorigin="anonymous"
    />
    <link href="https://fonts.googleapis.com/css?family=Roboto:100" rel="stylesheet">
    <link rel="stylesheet" href="styleuploadindex.css">
    <link rel="stylesheet" href="stylebackgroundindex.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css'> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <link href="styleheaderindex.css" rel="stylesheet">
    <link href="stylemenuindex.css" rel="stylesheet">
    <title>Text to Audio - Index</title>
</head>
<body>
<header>
    <div class="container">
      <div class="row">
        <div class="col mr-auto">
          <a href="home.html" class="header-logo col">Home</a>
        </div>
        <nav class="header-menu">
          <ul>
            <li><a href="homefr.html">Fran√ßais</a></li>
            <li><a href="https://mp3.to/player/?lang=en" target="_blank">Listen Here!</a></li> 
            <li><a href="help.html">Need Help?</a></li> 
            <li><a href="contactus.html">Contact Us</a></li> 
          </ul>
        </nav>
      </div>
    </div>
</header>
        <div class="container">
            <input
                type="file"
                class="upload_hide"
                id="upload_costum"
                multiple
            />
            <label for="upload_costum" class="upload_label">
                <div class="image">
                    <img src="" alt="" />
                </div>
                <i class="fas fa-cloud-upload-alt"></i>
                <p class="drag_text">Slide and drop your file here</p>
                <button class="choose_file">Choose a PDF file</button>
                <p>Please drag and drop the file you wish to be converted</p>
            </label>
            <button class="delete_file">Delete the file</button>
        </div>
        <div class="vertical-menu">
            <a href="https://cloudconvert.com/epub-to-pdf">.EPub?</a>
            <a href="https://cloudconvert.com/txt-to-pdf">.TXT?</a>
            <a href="https://cloudconvert.com/docx-to-pdf">.Docx?</a>
            <a href="https://cloudconvert.com/mobi-to-pdf">.Mobi?</a>
            <a style="font-weight: bold;" id="btnUpload">Upload</a>          
        </div>

        <script
            src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
            crossorigin="anonymous"
        ></script>
        <script>
            $(".delete_file").hide();
            $("#upload_costum").change(function (event) {
                let tmppath = URL.createObjectURL(event.target.files[0]);
                $(".image > img").fadeIn("fast").attr("src", tmppath);
                $(".delete_file").show();
                $(".choose_file").hide();

                $(".delete_file").click(function () {
                    $(".image > img").fadeIn("fast").attr("src", "");
                    $(".delete_file").hide();
                });
            });

        </script>

           <!-- <button type="button" id="btnUpload">Upload</button> -->
            <br>
            <br>
            <textarea style="width: 300px; height: 150px; float: right;" id="resultText" placeholder="The preview of your PDF text will appear here..."></textarea>

        <script>
        const upload_costum = document.getElementById("upload_costum");
        const btnUpload = document.getElementById("btnUpload");
        const resultText = document.getElementById("resultText");

        btnUpload.addEventListener("click", () => {
            const formData = new FormData();

            formData.append("pdfFile", upload_costum.files[0]);

            var filename = "pdf.txt";

            fetch("/extract-text", {
                method: "post",
                body: formData
            }).then(response => {
                return response.text();
            }).then(extractedText => {
                resultText.value = extractedText.trim();
            }).then(dwnpdf => {
                
                downloadtxt = download(filename, resultText.value);
            
            });

            
        });

        function download(filename, text) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
            
        }

        // Start file download.
        document.getElementById("dwn-btn").addEventListener("click", function(){
            // Generate download of hello.txt file with some content
            var filename = "pdf.txt";
            download(filename, resultText.value);
        }, false);
        </script>
    <body>
        <textarea
            id="phraseDiv"
            style="
                display: inline-block;
                width: 500px;
                height: 50px;
            "
            maxlength="255"
            onblur="updateSrc()"
        >
</textarea
        >
    </td>
</tr>
<tr>
    <td align="right">Select Voice Sound</td>
    <td>
        <select id="voiceName" onblur="updateSrc()">
            <option value="" selected>Default</option>
            <option value="zh-HK-HiuGaaiNeural">
                Chinese (Neural, Female, Cantonese 1,
                Traditional)
            </option>
            <option value="zh-HK-HiuMaanNeural">
                Chinese (Neural, Female, Cantonese 2,
                Traditional)
            </option>
            <option value="zh-HK-HiuMaanNeural">
                Chinese (Neural, Female, Cantonese 3,
                Traditional)
            </option>
            <option value="zh-HK-WanLungNeural">
                Chinese (Neural, Male, Cantonese 4, Traditional)
            </option>
            <option value="zh-CN-XiaoxiaoNeural">
                Chinese (Neural, Female, Mandarin 1, Simplified)
            </option>
            <option value="zh-CN-XiaoyouNeural">
                Chinese (Neural, Female, Mandarin 2, Simplified)
            </option>
            <option value="zh-CN-XiaomoNeural">
                Chinese (Neural, Female, Mandarin 3, Simplified)
            </option>
            <option value="zh-CN-XiaoxuanNeural">
                Chinese (Neural, Female, Mandarin 4, Simplified)
            </option>
            <option value="zh-CN-XiaohanNeural">
                Chinese (Neural, Female, Mandarin 5, Simplified)
            </option>
            <option value="zh-CN-XiaoruiNeural">
                Chinese (Neural, Female, Mandarin 6, Simplified)
            </option>
            <option value="zh-CN-YunyangNeural">
                Chinese (Neural, Male, Mandarin 7, Simplified)
            </option>
            <option value="zh-CN-YunyeNeural">
                Chinese (Neural, Male, Mandarin 8, Simplified)
            </option>
            <option value="zh-CN-YunxiNeural">
                Chinese (Neural, Male, Mandarin 9, Simplified)
            </option>
            <option value="zh-TW-HsiaoChenNeural">
                Chinese (Neural, Female, Taiwanese 1, Mandarin)
            </option>
            <option value="zh-TW-HsiaoYuNeural">
                Chinese (Neural, Female, Taiwanese 2, Mandarin)
            </option>
            <option value="zh-TW-YunJheNeural">
                Chinese (Neural, Male, Taiwanese 3, Mandarin)
            </option>
            <option value="en-HK-YanNeural">
                English (Neural, Female, English 1, Hong Kong)
            </option>
            <option value="en-HK-SamNeural">
                English (Neural, Male, English 2, Hong Kong)
            </option>
            <option value="en-SG-LunaNeural">
                English (Neural, Female, English 3, Singapore)
            </option>
            <option value="en-SG-WayneNeural">
                English (Neural, Male, English 4, Singapore)
            </option>
            <option value="en-GB-LibbyNeural">
                English (Neural, Female, English 5, United
                Kingdom)
            </option>
            <option value="en-GB-MiaNeural">
                English (Neural, Female, English 6, United
                Kingdom)
            </option>
            <option value="en-GB-RyanNeural">
                English (Neural, Male, English 7, United
                Kingdom)
            </option>
            <option value="en-US-AriaNeural">
                English (Neural, Female, English 8, United
                States)
            </option>
            <option value="en-US-JennyNeural">
                English (Neural, Female, English 9, United
                States)
            </option>
            <option value="en-US-GuyNeural">
                English (Neural, Male, English 10, United
                States)
            </option>
            <option value="en-PH-RosaNeural">
                English (Neural, Female, English 11,
                Philippines)
            </option>
            <option value="en-PH-JamesNeural">
                English (Neural, Male, English 12, Philippines)
            </option>
        </select>
    </td>
</tr>
<tr>
    <td align="right">
        Stream Audio
    </td>
    <td>
        <div>
            <button
                id="clientAudioAzure"
                onclick="getSpeechFromAzure()"
            >
                Listen Now
            </button>
        </div>
    </td>
</tr>

<tr>
    <td align="right">Stream Audio</td>
    <td>
        <audio
            id="serverAudioFile"
            controls
            preload="none"
            onerror="DisplayError()"
        ></audio>
    </td>
</tr>
</table>
</div>

<!-- Speech SDK reference sdk. -->
<script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>

<!-- Speech SDK USAGE -->
<script>
// status fields and start button in UI
var phraseDiv;
var resultDiv;

// subscription key and region for speech services.
var resourceKey = "b974c7e81115411aa5076a392dad3380";
var resourceRegion = "eastus";
var textLang = "en-US";
var voiceName = "en-CA-ClaraNeural";
var authorizationToken;
var SpeechSDK;
var synthesizer;

var phrase = "Put text here!";
var queryString = null;

var audioType = "audio/mpeg";
var serverSrc = "/text-to-speech";

document.getElementById("serverAudioFile").disabled = true;
document.getElementById("clientAudioAzure").disabled = true;

// update src URL query string for Express.js server
function updateSrc() {
// input values
voiceName = document.getElementById("voiceName").value.trim();
phrase = document.getElementById("phraseDiv").value.trim();

// server control - by file
var serverAudioFileControl =
    document.getElementById("serverAudioFile");
queryString += `%file=true`;
const fileQueryString = `file=true&region=${resourceRegion}&key=${resourceKey}&phrase=${phrase}&textLang=${textLang}&voiceName=${voiceName}`;
serverAudioFileControl.src = `${serverSrc}?${fileQueryString}`;
console.log(serverAudioFileControl.src);
serverAudioFileControl.type = "audio/mpeg";
serverAudioFileControl.disabled = false;

// client control
var clientAudioAzureControl =
    document.getElementById("clientAudioAzure");
clientAudioAzureControl.disabled = false;
}

function DisplayError(error) {
window.alert(JSON.stringify(error));
}

// Client-side request directly to Azure Cognitive Services
function getSpeechFromAzure() {
// authorization for Speech service
var speechConfig = SpeechSDK.SpeechConfig.fromSubscription(
    resourceKey,
    resourceRegion
);
speechConfig.speechRecognitionLanguage = textLang;
speechConfig.speechSynthesisLanguage = textLang;
speechConfig.speechSynthesisVoiceName = voiceName;

// new Speech object
synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig);

synthesizer.speakTextAsync(
    phrase,
    function (result) {
        // Success function

        // display status
        if (
            result.reason ===
            SpeechSDK.ResultReason.SynthesizingAudioCompleted
        ) {
            // load client-side audio control from Azure response
            audioElement =
                document.getElementById("clientAudioAzure");
            const blob = new Blob([result.audioData], {
                type: "audio/mpeg",
            });
            const url = window.URL.createObjectURL(blob);
        } else if (
            result.reason === SpeechSDK.ResultReason.Canceled
        ) {
            // display Error
            throw result.errorDetails;
        }

        // clean up
        synthesizer.close();
        synthesizer = undefined;
    },
    function (err) {
        // Error function
        throw err;
        audioElement = document.getElementById("audioControl");
        audioElement.disabled = true;

        // clean up
        synthesizer.close();
        synthesizer = undefined;
    }
);
}

// Initialization
document.addEventListener("DOMContentLoaded", function () {
var clientAudioAzureControl =
    document.getElementById("clientAudioAzure");
var resultDiv = document.getElementById("resultDiv");

resourceKey = resourceKey;
resourceRegion = resourceRegion;
textLang = textLang;
voiceName = document.getElementById("voiceName").value;
phrase = document.getElementById("phraseDiv").value;
if (!!window.SpeechSDK) {
    SpeechSDK = window.SpeechSDK;
    clientAudioAzure.disabled = false;
}
});
</script>
</body>
</html>

